"use strict";var A=Object.create;var l=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var I=(r,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of E(t))!j.call(r,e)&&e!==n&&l(r,e,{get:()=>t[e],enumerable:!(s=k(t,e))||s.enumerable});return r};var p=(r,t,n)=>(n=r!=null?A(R(r)):{},I(t||!r||!r.__esModule?l(n,"default",{value:r,enumerable:!0}):n,r));var $=p(require("path"));var a=p(require("fs")),w=require("child_process"),g=require("os"),h=p(require("path"));function f(){let r={"User-Agent":"GitHub Actions"};return process.env.GITHUB_TOKEN&&(r.Authorization=`token ${process.env.GITHUB_TOKEN}`),{headers:r}}async function u(r,t){if(!t){let e=r.split("/").at(-1);t=h.join((0,g.tmpdir)(),e)}let s=await(await fetch(r,f())).arrayBuffer();return a.writeFileSync(t,Buffer.from(s)),t}function d(r,t){a.existsSync(t)||a.mkdirSync(t,{recursive:!0});let n=[{ext:[".zip"],cmd:`unzip -o "${r}" -d "${t}"`},{ext:[".tar"],cmd:`tar -xf "${r}" -C "${t}"`},{ext:[".tar.gz",".tgz"],cmd:`tar -xzf "${r}" -C "${t}"`},{ext:[".tar.bz2"],cmd:`tar -xjf "${r}" -C "${t}"`},{ext:[".7z"],cmd:`7z x "${r}" -o"${t}"`},{ext:[".rar"],cmd:`unrar x "${r}" "${t}"`},{ext:[".rar"],cmd:`unrar x "${r}" "${t}"`}];for(let{ext:s,cmd:e}of n)for(let o of s)if(r.endsWith(o))return(0,w.execSync)(e);console.error(`Error: Unsupported file type: ${r}`)}function x(r,t=process.platform,n=process.arch){let s;switch(n){case"arm64":s="aarch64";break;case"x64":s="x86_64";break;default:throw new Error(`Unsupported architechture ${process.arch}.`)}let e;switch(t){case"linux":e=["unknown-linux-gnu"];break;case"darwin":e=["apple-darwin"];break;case"win32":e=["pc-windows-msvc","pc-windows-gnu"];break;default:throw new Error(`Unsupported platform ${t}.`)}return e.map(o=>`${r}-${s}-${o}`)}var i=class{name;owner;constructor(t){let n=/https:\/\/github\.com\/([^\/]+)\/([^\/]+)/,s=t.match(n);if(!s)throw new Error("Invalid github repo url");this.owner=s[1],this.name=s[2]}getReleasesApiUrl(t="latest"){return t==="latest"?`https://api.github.com/repos/${this.owner}/${this.name}/releases/latest`:`https://api.github.com/repos/${this.owner}/${this.name}/releases/tags/${t}`}async getRelease(t="latest"){let n=this.getReleasesApiUrl(t);return await fetch(n,f()).then(e=>e.json())}async getAssetUrl(t=this.name,n="latest",s=process.platform,e=process.arch){let o=await this.getRelease(n),c=x(t,s,e),m=o.assets.find(v=>c.some(z=>v.name.startsWith(z)));if(!m)throw new Error(`No asset found for ${t} ${n} ${s} ${e}`);return m.browser_download_url}};var y=require("os");async function b(r){let{repo:t,version:n="latest",bin:s}=r,e=await new i(t).getAssetUrl(s?.length?s:void 0,n),o=$.default.join((0,y.homedir)(),"easy-setup"),c=await u(e);return await d(c,o),{version:n,installDir:o,downloadUrl:e}}var U=process.argv[2],O=process.argv[2];U||(console.log("easy-setup <repo> [<version>]"),process.exit());b({repo:U,version:O}).then(r=>{console.log(r)});
